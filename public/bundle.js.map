{"version":3,"file":"bundle.js","sources":["../src/Display.ts","../src/Inputs.ts","../build/manual.wasm","../src/interface.ts","../src/index.ts"],"sourcesContent":["import { WasmInterface } from \"./interface\";\r\n\r\nexport default class Display {\r\n  e: HTMLTextAreaElement;\r\n  w: number;\r\n  h: number;\r\n\r\n  constructor(private i: WasmInterface) {\r\n    this.e = document.createElement(\"textarea\");\r\n    this.e.cols = i.width + 2;\r\n    this.e.rows = i.height;\r\n    this.e.readOnly = true;\r\n\r\n    this.w = i.width;\r\n    this.h = i.height;\r\n\r\n    document.body.append(this.e);\r\n    this.refresh();\r\n  }\r\n\r\n  tile(x: number, y: number) {\r\n    if (x === this.i.px && y === this.i.py) return \"@\";\r\n    return String.fromCharCode(this.i.tiles[y * this.w + x]);\r\n  }\r\n\r\n  refresh() {\r\n    let s = \"\";\r\n    for (let y = 0; y < this.h; y++) {\r\n      s += \"\\n\";\r\n      for (let x = 0; x < this.w; x++) {\r\n        const ch = this.tile(x, y);\r\n\r\n        s += ch;\r\n      }\r\n    }\r\n\r\n    this.e.value = s.substr(1);\r\n  }\r\n}\r\n","import { WasmInterface } from \"./interface\";\r\n\r\nconst conversion = {\r\n  ArrowUp: 1000,\r\n  ArrowRight: 1001,\r\n  ArrowDown: 1002,\r\n  ArrowLeft: 1003,\r\n\r\n  Backspace: 8,\r\n  Tab: 9,\r\n  Enter: 13,\r\n  Escape: 27,\r\n  Delete: 127,\r\n\r\n  Alt: -1,\r\n  AltGraph: -1,\r\n  AudioVolumeDown: -1,\r\n  AudioVolumeMute: -1,\r\n  AudioVolumeUp: -1,\r\n  CapsLock: -1,\r\n  Clear: -1,\r\n  ContextMenu: -1,\r\n  Control: -1,\r\n  End: -1,\r\n  F1: -1,\r\n  F10: -1,\r\n  F11: -1,\r\n  F12: -1,\r\n  F2: -1,\r\n  F3: -1,\r\n  F4: -1,\r\n  F5: -1,\r\n  F6: -1,\r\n  F7: -1,\r\n  F8: -1,\r\n  F9: -1,\r\n  Home: -1,\r\n  Insert: -1,\r\n  LaunchApplication2: -1,\r\n  MediaPlayPause: -1,\r\n  NumLock: -1,\r\n  PageDown: -1,\r\n  PageUp: -1,\r\n  Pause: -1,\r\n  ScrollLock: -1,\r\n  Shift: -1,\r\n};\r\n\r\nexport default class Inputs {\r\n  constructor(private i: WasmInterface, cb: (key: string, id: number) => void) {\r\n    window.addEventListener(\"keydown\", (e) => {\r\n      const id = conversion[e.key] ?? e.key.charCodeAt(0);\r\n      if (id < 0) return;\r\n\r\n      if (i.input(id)) {\r\n        e.preventDefault();\r\n        cb(e.key, id);\r\n      }\r\n    });\r\n  }\r\n}\r\n","export default \"manual.wasm\"","import module from \"../build/manual.wasm\";\n\ninterface ModuleInterface {\n  gHeight: WebAssembly.Global;\n  gWidth: WebAssembly.Global;\n  gTiles: WebAssembly.Global;\n  gPX: WebAssembly.Global;\n  gPY: WebAssembly.Global;\n\n  memory: WebAssembly.Memory;\n\n  draw(x: number, y: number, ch: number): void;\n  initialise(w: number, h: number): void;\n  input(code: number): boolean;\n  playerMove(mx: number, my: number): void;\n}\n\nexport class WasmInterface {\n  constructor(private i: ModuleInterface) {}\n\n  get width(): number {\n    return this.i.gWidth.value;\n  }\n  get height(): number {\n    return this.i.gHeight.value;\n  }\n  get tileSize(): number {\n    return this.width * this.height;\n  }\n  get px(): number {\n    return this.i.gPX.value;\n  }\n  get py(): number {\n    return this.i.gPY.value;\n  }\n\n  get tiles() {\n    return new Uint8Array(\n      this.i.memory.buffer.slice(this.i.gTiles.value, this.tileSize)\n    );\n  }\n\n  draw(x: number, y: number, ch: string): void {\n    return this.i.draw(x, y, ch.charCodeAt(0));\n  }\n\n  initialise(width: number, height: number): void {\n    return this.i.initialise(width, height);\n  }\n\n  input(id: number): boolean {\n    return this.i.input(id);\n  }\n}\n\nconst getInterface = () =>\n  WebAssembly.instantiateStreaming(fetch(module)).then(\n    ({ instance }) =>\n      new WasmInterface(instance.exports as unknown as ModuleInterface)\n  );\n\nexport default getInterface;\n","import Display from \"./Display\";\r\nimport Inputs from \"./Inputs\";\r\nimport getInterface from \"./interface\";\r\n\r\ngetInterface().then((i) => {\r\n  (window as any).i = i;\r\n\r\n  i.initialise(80, 50);\r\n\r\n  const d = new Display(i);\r\n  const n = new Inputs(i, (key, id) => {\r\n    console.log(\"key\", key, id);\r\n    d.refresh();\r\n  });\r\n\r\n  (window as any).d = d;\r\n  (window as any).n = n;\r\n});\r\n"],"names":[],"mappings":"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"}